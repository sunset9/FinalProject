<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="ticket.dao.face.TicketDao">

 <resultMap type="ticket.dto.PfmDateByTime" id="dateTimeMap">
	<result column="pfm_dbt_idx" property="pfmDbtIdx"/>
	<result column="pfm_idx" property="pfmIdx"/>
	<result column="pfm_date" property="pfmDate"/>
	<result column="pfm_time" property="pfmTime"/>
	<result column="create_date" property="createDate"/>
</resultMap>

<resultMap type="ticket.dto.OriginSection" id="oriSecMap">
	<result column="ori_sec_idx" property="oriSecIdx"/>
	<result column="hall_idx" property="hallIdx"/>
	<result column="sec_name" property="secName"/>
</resultMap>

<resultMap type="ticket.dto.SeatSection" id="seatSectionMap">
	<result column="sec_idx" property="secIdx"/>
	<result column="hall_idx" property="hallIdx"/>
	<result column="pfm_idx" property="pfmIdx"/>
	<result column="ori_sec_idx" property="oriSecIdx"/>
	<result column="app_sec" property="appSec"/>
	<result column="sec_pay" property="secPay"/>
	<result column="create_date" property="createDate"/>
</resultMap>

<resultMap type="ticket.dto.Seat" id="seatMap">
	<result column="seat_idx" property="seatIdx"/>
	<result column="seat_row" property="seatRow"/>
	<result column="seat_col" property="seatCol"/>
	<result column="ori_sec_idx" property="oriSecIdx"/>
	<result column="hall_idx" property="hallIdx"/>
	<result column="seat_floor" property="seatFloor"/>
</resultMap>


<select id="selectDates" parameterType="ticket.dto.Performance" resultMap="dateTimeMap">
	select pfm_date from pfm_dateBytime WHERE pfm_idx = #{pfmIdx} GROUP BY pfm_date
</select>

<select id ="selectDateTime" parameterType="ticket.dto.Performance" resultMap="dateTimeMap">
	select pfm_idx,pfm_date,pfm_time from pfm_dateBytime WHERE pfm_idx= #{pfmIdx}
</select>

<select id="selectOriSecByHallIdx" parameterType="ticket.dto.Hall" resultMap="oriSecMap">
	select ori_sec_idx, hall_idx, sec_name from originsection where hall_idx = #{hallIdx}
</select>

<select id ="selectSeatSectionByPfmIdx" parameterType="ticket.dto.Performance" resultMap="seatSectionMap">
	SELECT
	    sec.sec_idx,
	    sec.hall_idx,
	    sec.ori_sec_idx,
	    sec.app_sec,
	    sec.sec_pay,
	    sec.create_date,
	    orisec.sec_name as oriSecName
	FROM
	    seatsection sec
	    LEFT JOIN originsection orisec ON sec.ori_sec_idx = orisec.ori_sec_idx
	WHERE
	    pfm_idx = #{pfmIdx}
</select>

<select id="selectCntSectionByPfmIdx" parameterType="ticket.dto.Performance" resultType="String">
	Select DISTINCT app_sec from seatsection
</select>

<select id ="selectSeatsByHallIdx" parameterType="ticket.dto.Hall" resultMap="seatMap">
	select * from seat where hall_idx = #{hallIdx}
</select>

<select id="selectMaxRow" parameterType="int" resultType="int">
	select max(seat_row) from seat where ori_sec_idx =#{oriSecIdx}
</select>

<select id="selectMaxCol" parameterType="int" resultType="int">
	select max(seat_col) from seat where ori_sec_idx =#{oriSecIdx}
</select>

</mapper>