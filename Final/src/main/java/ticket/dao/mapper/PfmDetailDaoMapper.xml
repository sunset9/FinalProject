<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ticket.dao.face.PfmDetailDao">

	<resultMap type="ticket.dto.Performance" id="Performance">
		<result column="pfm_idx" property="pfmIdx"/>
	</resultMap>
	
	<resultMap type="ticket.dto.Artist" id="Artist">
		<result column="artist_idx" property="artistIdx"/>
		<result column="theme_idx" property="themeIdx"/>
		<result column="img_uri" property="imgUri"/>	
	</resultMap>
	
	<resultMap type="ticket.dto.PfmDetail" id="PfmDetail">
		<result column="pfm_detail_idx" property="pfmDetailIdx"/>
		<result column="pfm_idx" property="pfmIdx"/>
		<result column="create_date" property="createDate"/>
		<result column="contents" property="contents"/>
	</resultMap>
		
	<select id="selectChoiceDetail" parameterType="ticket.dto.Performance" resultType="ticket.dto.Poster">
		SELECT
			poster_idx as posterIdx
			, pfm_idx as pfmIdx
			, origin_name as originName
			, stored_name as storedName
			, create_date as createDate
		FROM poster_info
		WHERE pfm_idx IN (
		    SELECT pfm_idx as pfmIdx
		    FROM performance
		    WHERE pfm_idx=#{pfmIdx}
		)
	</select>
	
	<select id="selectPfmInfo" parameterType="ticket.dto.Performance" resultType="ticket.dto.Performance">
		SELECT
			pfm_idx as pfmIdx
			, hall_idx as hallIdx
			, name
			, genre_idx as genreIdx
			, pfm_start as pfmStart
			, pfm_end as pfmEnd
			, age_grade_idx as ageGradeIdx
			, running_time as runningTime
		FROM performance
		WHERE pfm_idx=#{pfmIdx}
	</select>
	
	<select id="selectPfmDetailInfo" parameterType="ticket.dto.Performance" resultMap="PfmDetail">
		SELECT * FROM pfm_detail
		WHERE pfm_idx=#{pfmIdx}
	</select>
	
	<select id="selectCastInfo" parameterType="ticket.dto.Performance" resultMap="Artist">
		SELECT
			a.artist_idx
		    , name
		    , img_uri
		FROM (
		    SELECT artist_idx
		    FROM cast
		    WHERE pfm_idx=#{pfmIdx}
		) c
		LEFT JOIN artist a
		    ON c.artist_idx = a.artist_idx
	</select>
	
	<select id="selectExpectationList" parameterType="ticket.dto.Performance" resultType="ticket.dto.Expectation">
		SELECT
		    e.exp_content as expContent
		    , e.create_date as createDate
		    , u.profile
		    , u.name
		FROM (
		    SELECT
		    	*
		    FROM expectation
		    WHERE pfm_idx=#{pfmIdx}
		) e
		LEFT JOIN userinfo u
		    ON u.user_idx = e.user_idx
	</select>
	
</mapper>