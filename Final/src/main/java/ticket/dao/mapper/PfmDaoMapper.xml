<?xml version="1.0" encoding="UTF-8"?>

<!-- 마이바티스 3 매퍼 DOCTYPE -->
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ticket.dao.face.PfmDao">

	<resultMap type="ticket.dto.Genre" id="Genre">
		<result column="genre_idx" property="genreIdx"/>
		<result column="genre" property="genre"/>
	</resultMap>
	
	<resultMap type="ticket.dto.Theme" id="Theme">
		<result column="theme_idx" property="themeIdx"/>
		<result column="theme_name" property="themeName"/>
		<result column="genre_idx" property="genreIdx"/>
	</resultMap>

	<select id="selectAllGenre" resultMap="Genre">
		SELECT genre_idx, genre
		FROM genre
		ORDER BY genre_idx
	</select>

	<select id="selectAllTheme" parameterType="ticket.dto.Genre" resultMap="Theme">
		SELECT theme_idx, theme_name, genre_idx
		FROM theme
		WHERE genre_idx = #{genreIdx }
		ORDER BY theme_idx
	</select>
	
	<select id="selectAllAgeGrade" resultType="ticket.dto.AgeGrade">
		SELECT age_grade_idx as ageGradeIdx, age_limit as ageLimit  
		FROM age_grade
		ORDER BY age_limit
	</select>
	
	<select id="selectArtistByName" parameterType="ticket.dto.Artist" resultType="ticket.dto.Artist">
		SELECT 
			artist_idx as artistIdx, theme_idx as themeIdx, name as name, img_uri as imgUri
		FROM artist
		WHERE name LIKE '%${name }%'
	</select>
	
	<select id="selectAllHall">
	
	</select>
	
  	<insert id="insertPfm" parameterType="ticket.dto.Performance">
		<selectKey keyProperty="pfmIdx" resultType="int" order="BEFORE">
			SELECT performance_seq.nextval FROM DUAL
		</selectKey>
		
		INSERT INTO performance(pfm_idx ,name ,genre_idx ,pfm_start ,pfm_end 
			,ticket_start ,ticket_end ,hall_idx ,age_grade_idx ,running_time )
		VALUES (#{pfmIdx }, #{name }, #{genreIdx }, '2018-08-01', '2018-08-02'
			, #{ticketStart }, #{ticketEnd }, 1, #{ageGradeIdx }, #{runningTime })
		
	</insert>
  
	<select id="selectTodayBook" resultType="int">
		SELECT COUNT(*) FROM book
		WHERE to_char(create_date, 'yy/mm/dd') = to_char(SYSDATE, 'yy/mm/dd')
			AND (book_cate_idx = 1 OR book_cate_idx = 2)
	</select>
	
	<select id="selectTodayCancel" resultType="int">
		SELECT COUNT(*) FROM book
		WHERE to_char(create_date, 'yy/mm/dd') = to_char(SYSDATE, 'yy/mm/dd')
			AND (book_cate_idx = 3 OR book_cate_idx = 4)
	</select>
	
	<select id="selectTodayAllPfm" resultType="int">
		
	</select>
	
	<select id="selectTodayCon" resultType="int">
		
	</select>
	
	<insert id="insertPfmTheme" parameterType="ticket.dto.PfmTheme">
		INSERT INTO pfm_theme(pfm_theme_idx ,pfm_idx ,theme_idx)
		VALUES (pfm_theme_seq.nextval, #{pfmIdx }, #{themeIdx } )
	</insert>
	
	<insert id="insertPoster" parameterType="ticket.dto.Poster">
		INSERT INTO poster_info (poster_idx , pfm_idx , origin_name , stored_name )
		VALUES (poster_info_seq.nextval, #{pfmIdx }, #{originName }, #{storedName })
	</insert>
	
	<insert id="insertCast" parameterType="ticket.dto.Cast">
		INSERT INTO cast (cast_idx ,pfm_idx ,artist_idx)
		VALUES (cast_seq.nextval, #{pfmIdx }, #{artistIdx })
	</insert>
</mapper>