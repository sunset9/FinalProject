<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="ticket.dao.face.MainDao">
	
	<resultMap type="ticket.dto.Theme" id="Theme">
		<result column="theme_name" property="themeName"/>
	</resultMap>
	
	<resultMap type="ticket.dto.Poster" id="Poster">
		<result column="poster_idx" property="posterIdx"/>
		<result column="pfm_idx" property="pfmIdx"/>
		<result column="origin_name" property="originName"/>
		<result column="stored_name" property="storedName"/>
		<result column="create_date" property="createDate"/>
	</resultMap>
	
	<!-- 상단 배너 -->
	<select id="selectAdminBanCon" resultMap="Poster">
			SELECT
				poster_idx
				, pfm_idx
				, origin_name
				, stored_name
				, create_date
			FROM poster_info
			WHERE pfm_idx IN (
			    SELECT pfm_idx as pfmIdx FROM performance
			    WHERE pfm_idx IN (
			        SELECT pfm_idx as pfmIdx FROM category_con
			    )
			)
	</select>
	
	<select id="selectAdminBanMu" resultMap="Poster">
		SELECT
			poster_idx
			, pfm_idx
			, origin_name
			, stored_name
			, create_date
		FROM poster_info
		WHERE pfm_idx IN (
			SELECT pfm_idx as pfmIdx FROM performance
			WHERE pfm_idx IN (
				SELECT pfm_idx as pfmIdx FROM category_mu
			)
		)
	</select>
	
	<!-- 원하는 선택결과에 맞는 포스터 이미지 출력 -->
	<select id="selectPfmPosterInfo" resultType="ticket.dto.Poster">
		SELECT
			poster_idx as posterIdx,
			pfm_idx as pfmIdx,
			origin_name as originName,
			stored_name as storedName,
			create_date as createDate
		FROM poster_info
		WHERE pfm_idx IN (
		    SELECT pfm_idx FROM performance
		    WHERE genre_idx=1
		)
	</select>
	
	<!-- 테마 정보 출력 -->
	<select id="selectConThemeKind" resultMap="Theme">
		SELECT theme_name
		FROM theme
		where genre_idx=1
	</select>
	
	<select id="selectMuThemeKind" resultMap="Theme">
		SELECT theme_name
		FROM theme
		where genre_idx=2
	</select>
	
	<select id="selectFamThemeKind" resultMap="Theme">
		SELECT theme_name
		FROM theme
		where genre_idx=3
	</select>
	
	<!-- 리스트 출력 -->	
	<select id="ConThemeChoice" parameterType="ticket.dto.Theme" resultMap="Poster">
		SELECT
			origin_name
		FROM poster_info p, theme t
		WHERE pfm_idx IN (
		    SELECT pfm_idx as pfmIdx
		    FROM pfm_theme
		    WHERE pfm_idx IN (
		        SELECT pfm_idx as pfmIdx
		        FROM performance
		        WHERE genre_idx=1
		    )
		)
		AND theme_name=#{theme_name}
	</select>

</mapper>